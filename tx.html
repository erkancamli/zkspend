<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>zkSpend · TX / Claim Viewer</title>
<link rel="icon" href="data:,">
<style>
  :root { color-scheme: dark light; }
  body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:#0b0f14; color:#e6edf3 }
  header { padding:16px 20px; border-bottom:1px solid #1f2630; background:#0e141b; position:sticky; top:0; z-index:1 }
  header h1 { margin:0; font-size:18px; font-weight:600 }
  .wrap { display:grid; grid-template-columns: 320px 1fr; gap:16px; min-height:calc(100vh - 60px) }
  @media (max-width: 900px){ .wrap{ grid-template-columns: 1fr } }
  aside { border-right:1px solid #1f2630; padding:12px 8px; background:#0b1118 }
  .search { padding:8px 10px; width:100%; border:1px solid #223040; border-radius:10px; background:#0d1520; color:#cbd5e1 }
  ul { list-style:none; margin:12px 0 0; padding:0; max-height:calc(100vh - 150px); overflow:auto }
  li a { display:block; padding:10px 12px; border-radius:10px; color:#cbd5e1; text-decoration:none }
  li a:hover { background:#111a24 }
  .mono{ font-family: ui-monospace,SFMono-Regular,Consolas,Monaco,monospace }
  main { padding:16px 20px }
  .card { background:#0d1520; border:1px solid #1f2630; border-radius:14px; padding:14px; margin:0 0 16px }
  .row { display:grid; grid-template-columns: 160px 1fr auto; gap:10px; padding:8px 0; border-bottom:1px dashed #1f2630 }
  .row:last-child{ border-bottom:0 }
  .pill { font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid #334155; color:#cbd5e1 }
  .btn { padding:6px 10px; border-radius:10px; border:1px solid #334155; background:#0b1118; color:#cbd5e1; cursor:pointer }
  .muted { color:#94a3b8 }
  .links a { margin-right:10px }
  .empty { padding:20px; color:#94a3b8 }
</style>
</head>
<body>
<header>
  <h1>zkSpend · TX / Claim Viewer</h1>
</header>
<div class="wrap">
  <aside>
    <input id="q" class="search mono" placeholder="Ara veya tx yapıştır (Enter)"/>
    <ul id="list"></ul>
  </aside>
  <main>
    <div id="view" class="empty">Soldan bir işlem seçin veya URL'ye <span class="mono">?tx=&lt;hash&gt;</span> ekleyin.</div>
  </main>
</div>

<script>
const INDEX_URL = 'docs/claims/index.json';
const EXPLORER = (tx) => `https://evm-testnet.0g.ai/tx/${tx}`;
const $ = (q, el=document) => el.querySelector(q);
const listEl = $('#list');
const viewEl = $('#view');
const qEl = $('#q');

const short = (s, n=6) => s ? s.slice(0,2+n) + '…' + s.slice(-n) : '';
const copy = async (t) => { try{ await navigator.clipboard.writeText(t); alert('Kopyalandı'); }catch{} };

function field(obj, keys){ for(const k of keys){ if(obj && obj[k]) return obj[k]; } return null; }

async function fetchIndex(){
  try{
    const res = await fetch(INDEX_URL, {cache:'no-store'});
    const arr = await res.json();
    return Array.isArray(arr) ? arr : [];
  }catch(e){ console.error(e); return []; }
}

function renderList(items){
  listEl.innerHTML = '';
  if(!items.length){ listEl.innerHTML = '<li class="muted" style="padding:10px">Kayıt yok</li>'; return; }
  for(const it of items){
    const a = document.createElement('a');
    a.href = `?tx=${encodeURIComponent(it.tx)}`;
    a.innerHTML = `<span class="mono">${short(it.tx, 8)}</span> <span class="muted">· ${new Date(
      it.ts?.replace(/Z?$/,'Z')).toLocaleString()}</span>`;
    const li = document.createElement('li'); li.appendChild(a); listEl.appendChild(li);
  }
}

async function loadClaim(tx){
  viewEl.innerHTML = '<div class="card">Yükleniyor…</div>';
  try{
    const res = await fetch(`docs/claims/${tx}.json`, {cache:'no-store'});
    if(!res.ok) throw new Error('json yok');
    const c = await res.json();

    const rc  = field(c, ['rc','receiptCommitment']);
    const nul = field(c, ['nul','nullifier']);
    const pub = field(c, ['pub','publicInputHash']);
    const from = c.from || '';
    const ts = c.ts || '';
    const camp = field(c, ['campaign','contract']) || '';

    viewEl.innerHTML = `
      <div class="card">
        <div class="row"><div class="muted">Transaction</div><div class="mono">${tx}</div>
          <div><button class="btn" onclick="copy('${tx}')">Kopyala</button></div></div>
        <div class="row"><div class="muted">ReceiptCommitment</div><div class="mono">${rc||'-'}</div>
          <div><button class="btn" onclick="copy('${rc||''}')">Kopyala</button></div></div>
        <div class="row"><div class="muted">Nullifier</div><div class="mono">${nul||'-'}</div>
          <div><button class="btn" onclick="copy('${nul||''}')">Kopyala</button></div></div>
        <div class="row"><div class="muted">PublicInputHash</div><div class="mono">${pub||'-'}</div>
          <div><button class="btn" onclick="copy('${pub||''}')">Kopyala</button></div></div>
        <div class="row"><div class="muted">From</div><div class="mono">${from||'-'}</div>
          <div><button class="btn" onclick="copy('${from||''}')">Kopyala</button></div></div>
        <div class="row"><div class="muted">Campaign</div><div class="mono">${camp||'-'}</div>
          <div><button class="btn" onclick="copy('${camp||''}')">Kopyala</button></div></div>
        <div class="row"><div class="muted">Timestamp</div><div>${ts ? new Date(ts.replace(/Z?$/,'Z')).toLocaleString() : '-'}</div><div></div></div>
        <div class="row"><div class="muted">Bağlantılar</div>
          <div class="links">
            <a class="pill" href="docs/claims/${tx}.json" target="_blank" rel="noopener">Claim JSON</a>
            <a class="pill" href="${EXPLORER(tx)}" target="_blank" rel="noopener">Explorer</a>
          </div><div></div></div>
      </div>`;
  }catch(e){
    viewEl.innerHTML = `<div class="card">Claim bulunamadı: <span class="mono">${tx}</span></div>`;
  }
}

(async function init(){
  const items = await fetchIndex();
  renderList(items);

  // Arama / jump
  qEl.addEventListener('keydown', (ev)=>{
    if(ev.key==='Enter'){
      const v = qEl.value.trim();
      if(/^0x[0-9a-fA-F]{64}$/.test(v)) location.search='?tx='+v;
    }
  });

  const urlTx = new URLSearchParams(location.search).get('tx');
  if(urlTx) loadClaim(urlTx);
})();
</script>
</body>
</html>
