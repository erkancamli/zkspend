<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>zkSpend · Live (0G Galileo)</title>
<style>
  :root{--fg:#111;--muted:#666;--bg:#fff;--card:#fafafa;--bd:#e5e7eb}
  *{box-sizing:border-box} body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
  color:var(--fg);background:var(--bg);margin:0;padding:24px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:20px}
  h1{font-size:24px;margin:0} .muted{color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
  .card{background:var(--card);border:1px solid var(--bd);border-radius:14px;padding:16px}
  .addr{font-family:ui-monospace,Menlo,Consolas,monospace;word-break:break-all}
  button{padding:10px 14px;border-radius:10px;border:1px solid var(--bd);background:#fff;cursor:pointer}
  a{color:#2563eb;text-decoration:none} a:hover{text-decoration:underline}
  ul{padding-left:18px;margin:10px 0}
  footer{margin-top:28px;font-size:12px}
</style>
<header>
  <div>
    <h1>zkSpend — Live (0G Galileo)</h1>
    <div class="muted">Fixed RPC · shows campaign balances & last 10 claims</div>
  </div>
  <div><button id="refresh">Refresh</button></div>
</header>

<section class="grid" id="wrap"></section>

<footer class="muted">
  Explorer: <a href="https://evm-testnet.0g.ai" target="_blank" rel="noreferrer">evm-testnet.0g.ai</a> ·
  Repo: <a href="https://github.com/erkancamli/zkspend" target="_blank" rel="noreferrer">erkancamli/zkspend</a>
</footer>

<script>
const RPC = "https://evmrpc-testnet.0g.ai";            // fixed public RPC
const EXPL = "https://evm-testnet.0g.ai";
const CLAIMED_SIG = "0xcbcb845d94d59960a0c6e8b3a1f47ad81bb57269de43e89ff4f0fa656246f5f6";

const CAMPAIGNS = [
  { name: "Campaign (0.1 ETH reward)", addr: "0x8bbac06bd634f12250079fd1470c2016157f6bd8" },
  { name: "Campaign (0.002 ETH reward)", addr: "0xd35116e3984b9e7564079750ab726aa4c1d7e77d" },
];

function rpc(method, params=[]) {
  return fetch(RPC, {
    method: "POST",
    headers: {"content-type":"application/json"},
    body: JSON.stringify({jsonrpc:"2.0", id: 1, method, params})
  }).then(r => r.json()).then(j => {
    if (j.error) throw new Error(j.error.message);
    return j.result;
  });
}

function fmtEth(hexWei){
  if(!hexWei) return "0";
  const n = BigInt(hexWei);
  const d = 10n**18n;
  const i = n / d, f = n % d;
  const frac = f.toString().padStart(18,'0').replace(/0+$/,'');
  return frac ? `${i}.${frac}` : `${i}`;
}

async function loadOne(cg){
  const wrap = document.getElementById("wrap");
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <h3>${cg.name}</h3>
    <div class="addr"><a href="${EXPL}/address/${cg.addr}" target="_blank">${cg.addr}</a></div>
    <p><b>Balance:</b> <span class="bal">…</span> ETH</p>
    <p><b>Recent Claims (last 10)</b></p>
    <ul class="claims"><li class="muted">Loading…</li></ul>
  `;
  wrap.appendChild(card);

  const balWei = await rpc("eth_getBalance", [cg.addr, "latest"]);
  card.querySelector(".bal").textContent = fmtEth(balWei);

  const latest = await rpc("eth_blockNumber", []);
  const latestNum = parseInt(latest, 16);
  const from = Math.max(latestNum - 200000, 0);
  const logs = await rpc("eth_getLogs", [{
    address: cg.addr,
    fromBlock: "0x" + from.toString(16),
    toBlock: latest,
    topics: [CLAIMED_SIG]
  }]);

  const ul = card.querySelector(".claims");
  ul.innerHTML = "";
  logs.slice(-10).reverse().forEach(l => {
    const hex = l.data.startsWith("0x") ? l.data.slice(2) : l.data;
    const rc  = "0x" + hex.slice(0, 64);
    const nul = "0x" + hex.slice(64, 128);
    const li = document.createElement("li");
    const txs = l.transactionHash.slice(0,10)+"…";
    li.innerHTML = `tx=<a href="${EXPL}/tx/${l.transactionHash}" target="_blank">${txs}</a> · RC=${rc.slice(0,10)}… · NUL=${nul.slice(0,10)}…`;
    ul.appendChild(li);
  });
  if (logs.length === 0) ul.innerHTML = '<li class="muted">No claims yet.</li>';
}

async function load(){
  document.getElementById('refresh').disabled = true;
  document.getElementById('wrap').innerHTML = "";
  for (const c of CAMPAIGNS) await loadOne(c);
  document.getElementById('refresh').disabled = false;
}
document.getElementById('refresh').onclick = load;
load();
</script>
