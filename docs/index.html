<!doctype html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>zkSpend — Live Demo (0G Galileo)</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;max-width:980px;margin:32px auto;padding:0 16px}
  h1{margin:0 0 8px} small{opacity:.7}
  .card{border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin:16px 0}
  input,button{font:inherit;padding:10px;border:1px solid #ccc;border-radius:10px}
  code{background:#f6f8fa;padding:1px 6px;border-radius:6px}
  ul{margin:8px 0 0 18px}
  .ok{color:#16a34a}.fail{color:#dc2626}
  pre{background:#0b1220;color:#cfe3ff;padding:12px;border-radius:10px;overflow:auto;max-height:320px}
</style>

<h1>zkSpend <small>— private receipt → on-chain reward</small></h1>

<div class="card">
  <h3>Live Campaign</h3>
  <div>Campaign: <code id="campaign"></code></div>
  <div>RPC: <code id="rpc"></code></div>
  <p><button id="refresh">Refresh</button></p>
  <ul>
    <li>Balance: <b id="bal">–</b></li>
    <li>Last 10 claims:
      <ul id="claims"><li>–</li></ul>
    </li>
  </ul>
</div>

<div class="card">
  <h3>Tx viewer</h3>
  <p>
    <input id="tx" size="72" placeholder="0x… tx hash">
    <button id="load">Load</button>
    <a id="expl" target="_blank" rel="noreferrer">Open in Explorer</a>
  </p>
  <div id="status">–</div>
  <pre id="raw"></pre>
</div>

<script>
const CAMPAIGN = "0xd35116e3984b9e7564079750ab726aa4c1d7e77d";
const RPC      = "https://evmrpc-testnet.0g.ai";          // sabitledik
const CLAIMED_SIG = "0xcbcb845d94d59960a0c6e8b3a1f47ad81bb57269de43e89ff4f0fa656246f5f6";

document.getElementById('campaign').textContent = CAMPAIGN;
document.getElementById('rpc').textContent = RPC;

async function rpcCall(method, params){ 
  const r = await fetch(RPC, {method:"POST",headers:{"content-type":"application/json"},
    body: JSON.stringify({jsonrpc:"2.0",id:1,method,params}) });
  const j = await r.json();
  if(j.error) throw j.error;
  return j.result;
}

function weiToEth(weiHex){
  const n = BigInt(weiHex); const eth = Number(n)/1e18;
  return eth.toFixed(6)+" ETH";
}

async function load(){
  document.getElementById('refresh').disabled = true;
  const balWei = await rpcCall("eth_getBalance",[CAMPAIGN,"latest"]);
  document.getElementById('bal').textContent = weiToEth(balWei);

  const latest = await rpcCall("eth_blockNumber",[]);
  const latestNum = parseInt(latest,16);
  const from = Math.max(latestNum-100000,0);
  const logs = await rpcCall("eth_getLogs",[{
    address: CAMPAIGN, fromBlock:"0x"+from.toString(16), toBlock: latest, topics:[CLAIMED_SIG]
  }]);

  const ul = document.getElementById('claims'); ul.innerHTML = "";
  logs.slice(-10).reverse().forEach(l=>{
    const hex = (l.data||"").replace(/^0x/,"");
    const rc  = "0x"+hex.slice(0,64);
    const nul = "0x"+hex.slice(64,128);
    const a = document.createElement('a');
    a.href = "https://evm-testnet.0g.ai/tx/"+l.transactionHash; a.target="_blank";
    a.textContent = l.transactionHash.slice(0,10)+"…";
    const li = document.createElement('li');
    li.append("tx=",a," · RC=",rc.slice(0,10)+"…"," · NUL=",nul.slice(0,10)+"…");
    ul.appendChild(li);
  });

  document.getElementById('refresh').disabled = false;
}

async function viewTx(){
  const tx = document.getElementById('tx').value.trim();
  const raw = document.getElementById('raw'); raw.textContent = "";
  const expl = document.getElementById('expl'); expl.href = "https://evm-testnet.0g.ai/tx/"+tx;
  try{
    const rcpt = await rpcCall("eth_getTransactionReceipt",[tx]);
    const ok = rcpt && rcpt.status === "0x1";
    document.getElementById('status').innerHTML = ok ? '<b class="ok">Success</b>' : '<b class="fail">Failed</b>';
    raw.textContent = JSON.stringify(rcpt,null,2);
  }catch(e){
    document.getElementById('status').textContent = "Not found / RPC error";
  }
}

document.getElementById('refresh').onclick = load;
document.getElementById('load').onclick = viewTx;
load();
</script>
