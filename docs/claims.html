<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>zkSpend — Claim Artifacts</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;max-width:1100px;margin:40px auto;padding:0 16px}
  h1{margin:0 0 10px}
  .meta{color:#666;margin-bottom:16px}
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid #e5e7eb;padding:8px 10px;text-align:left;font-size:14px}
  th{background:#f8fafc}
  code{font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
  .muted{color:#6b7280}
</style>
<h1>zkSpend — Claims</h1>
<div class="meta">Live list from <code>docs/claims/index.json</code></div>
<table id="t">
  <thead>
    <tr>
      <th>#</th>
      <th>TX</th>
      <th>RC</th>
      <th>NUL</th>
      <th>CID</th>
      <th>When (UTC)</th>
      <th>JSON</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<script>
const EXPLORER = "https://evm-testnet.0g.ai/tx/";
function short(x){ return x ? x.slice(0,10)+"…" : ""; }
async function main(){
  const res = await fetch("./claims/index.json", {cache:"no-store"});
  if(!res.ok){ document.querySelector('#t tbody').innerHTML = '<tr><td colspan="7">index.json not found</td></tr>'; return; }
  const arr = await res.json();
  if(!Array.isArray(arr) || arr.length===0){
    document.querySelector('#t tbody').innerHTML = '<tr><td colspan="7">No claims yet.</td></tr>'; return;
  }
  // Yeni en üste gelsin
  arr.sort((a,b)=> String(b.ts||"").localeCompare(String(a.ts||"")));
  const tb = document.querySelector('#t tbody');
  tb.innerHTML = "";
  for (let i=0;i<arr.length;i++){
    const it = arr[i];
    const tx = it.tx || "";
    const file = it.file || (tx ? `${tx}.json` : "");
    // Tekil JSON'u okuyup RC/NUL/PUB çek
    let rc="", nul="";
    try{
      const jf = await fetch(`./claims/${file}`, {cache:"no-store"});
      if(jf.ok){
        const jd = await jf.json();
        rc  = jd.rc  || jd.receiptCommitment || "";
        nul = jd.nul || jd.nullifier        || "";
      }
    }catch(e){}
    const tr = document.createElement('tr');
    const cid = it.cid || "";
    tr.innerHTML = `
      <td>${i+1}</td>
      <td><a href="${EXPLORER}${tx}" target="_blank">${short(tx)}</a></td>
      <td><code class="muted">${short(rc)}</code></td>
      <td><code class="muted">${short(nul)}</code></td>
      <td><code>${cid}</code></td>
      <td><code>${it.ts || ""}</code></td>
      <td><a href="./claims/${file}" target="_blank">view</a></td>
    `;
    tb.appendChild(tr);
  }
}
main();
</script>
