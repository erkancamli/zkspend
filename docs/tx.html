<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>zkSpend · TX Viewer</title>
<style>
:root{--bg:#0b1020;--card:#11182c;--muted:#9bb0d1;--text:#eaf2ff;--accent:#67e8f9;--ok:#3ddc97;--bad:#ff6b6b}
*{box-sizing:border-box} body{margin:0;font:15px/1.5 ui-sans-serif,system-ui,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text)}
.wrap{max-width:980px;margin:40px auto;padding:0 16px}
.card{background:var(--card);border:1px solid #1f2a44;border-radius:14px;padding:18px 16px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
h1{margin:0 0 10px;font-size:20px} a{color:var(--accent);text-decoration:none}
.row{display:grid;grid-template-columns:140px 1fr;gap:10px;padding:8px 0;border-top:1px solid #1f2a44}
.row:first-of-type{border-top:none}
.k{color:var(--muted)} .v code{word-break:break-all}
.badge{display:inline-flex;align-items:center;gap:6px;background:#0f233f;border:1px solid #1f2a44;border-radius:999px;padding:6px 10px;margin-right:8px}
.btn{display:inline-flex;align-items:center;gap:8px;border:1px solid #1f2a44;background:#0f233f;padding:8px 10px;border-radius:10px;cursor:pointer}
.btn:hover{background:#132b50}
.note{color:var(--muted);margin-top:12px}
.err{color:var(--bad)}
.ok{color:var(--ok)}
.flex{display:flex;flex-wrap:wrap;gap:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>zkSpend · Transaction</h1>
    <div id="badges" class="flex" style="margin:8px 0 6px"></div>
    <div id="content"></div>
    <div class="note">Deep-link: <code id="deeplink"></code></div>
  </div>
</div>
<script>
const qs = new URLSearchParams(location.search);
const tx = qs.get('tx') || qs.get('hash') || '';
const base = location.pathname.replace(/\/tx\.html$/,'');
const claimsBase = base + '/docs/claims';
const badges = document.getElementById('badges');
const content = document.getElementById('content');
document.getElementById('deeplink').textContent = location.href;

function row(k, v){ return `
  <div class="row"><div class="k">${k}</div><div class="v">${v}</div></div>
`}

function btn(label, onclick){ const b=document.createElement('button'); b.className='btn'; b.textContent=label; b.onclick=onclick; return b; }

if(!tx){
  content.innerHTML = `<p class="err">TX hash eksik. Örnek: <code>?tx=0xabc...</code></p>`;
}else{
  const url = `${claimsBase}/${tx}.json`;
  fetch(url, {cache:'no-store'}).then(async r=>{
    if(!r.ok){ throw new Error('Claim JSON bulunamadı'); }
    const j = await r.json();
    const rc = j.rc || j.receiptCommitment || '';
    const nul = j.nul || j.nullifier || '';
    const pub = j.pub || j.publicInputHash || '';
    const campaign = (j.campaign || j.contract || '').toLowerCase();
    const from = (j.from || '');
    const ts = j.ts || '';
    const explorer = `https://evm-testnet.0g.ai/tx/${encodeURIComponent(tx)}`;

    badges.innerHTML = `
      <span class="badge">TX: <code>${tx.slice(0,10)}…</code></span>
      <a class="badge" href="${explorer}" target="_blank" rel="noreferrer">Open in 0G Explorer ↗</a>
      <a class="badge" href="${claimsBase}/${tx}.json" target="_blank" rel="noreferrer">Claim JSON ↗</a>
    `;

    const c = [];
    c.push(row('tx', `<code>${tx}</code>`));
    c.push(row('timestamp', ts ? `<code>${ts}</code>` : '<span class="err">—</span>'));
    c.push(row('campaign', campaign ? `<code>${campaign}</code>` : '<span class="err">—</span>'));
    c.push(row('from', from ? `<code>${from}</code>` : '<span class="err">—</span>'));
    c.push(row('receiptCommitment', rc ? `<code>${rc}</code>` : '<span class="err">—</span>'));
    c.push(row('nullifier', nul ? `<code>${nul}</code>` : '<span class="err">—</span>'));
    c.push(row('publicInputHash', pub ? `<code>${pub}</code>` : '<span class="err">—</span>'));
    content.innerHTML = c.join('');

    // butonlar
    const bar = document.createElement('div'); bar.className='flex';
    bar.style.marginTop = '12px';
    bar.appendChild(btn('Kopyala TX', async ()=>{ await navigator.clipboard.writeText(tx); alert('TX kopyalandı'); }));
    bar.appendChild(btn('Linki Kopyala', async ()=>{ await navigator.clipboard.writeText(location.href); alert('Link kopyalandı'); }));
    content.appendChild(bar);
  }).catch(err=>{
    badges.innerHTML='';
    content.innerHTML = `<p class="err">Hata: ${err.message}</p>
      <p class="note">Claim listesi: <a href="${base}/#claims">${base}/#claims</a></p>`;
  });
}
</script>
</body>
</html>
