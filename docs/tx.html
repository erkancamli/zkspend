<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>zkSpend · TX Viewer (0G Galileo)</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;max-width:960px;margin:40px auto;padding:0 16px;background:#0b1220;color:#e6e9ef}
  header{display:flex;gap:8px;align-items:center}
  input,button{font:inherit;padding:10px;border-radius:10px;border:1px solid #2a3346;background:#0f172a;color:#e6e9ef}
  button{cursor:pointer}
  .row{display:flex;gap:8px;align-items:center;margin:12px 0}
  .label{opacity:.7;width:130px}
  pre{background:#0f172a;border:1px solid #2a3346;border-radius:12px;padding:12px;overflow:auto}
  a{color:#8ab4ff}
  .muted{opacity:.7}
  .ok{color:#9be4a8}.err{color:#ff8da1}
</style>
<header>
  <h2 style="margin:0">zkSpend · TX Viewer</h2>
</header>

<div class="row">
  <div class="label">RPC</div>
  <input id="rpc" style="flex:1" value="https://evmrpc-testnet.0g.ai">
</div>
<div class="row">
  <div class="label">Tx</div>
  <input id="tx" style="flex:1" placeholder="0x...">
  <button id="load">Load</button>
</div>

<div class="row"><div class="label">Explorer</div>
  <div id="expl" class="muted">—</div>
</div>

<div class="row"><div class="label">Storage pointer</div>
  <div id="pointer" class="muted">—</div>
</div>

<h3 style="margin-top:24px">Receipt (raw)</h3>
<pre id="raw">—</pre>

<script>
const qs = new URLSearchParams(location.search);
if(qs.get('rpc')) document.getElementById('rpc').value = qs.get('rpc');
if(qs.get('tx'))  document.getElementById('tx').value  = qs.get('tx');

async function jrpc(url, method, params){
  const r = await fetch(url,{method:"POST",headers:{'content-type':'application/json'},
    body: JSON.stringify({jsonrpc:"2.0",id:1,method,params})});
  if(!r.ok) throw new Error("RPC HTTP "+r.status);
  const j = await r.json();
  if(j.error) throw new Error(j.error.message||"RPC error");
  return j.result;
}

function short(x){return x?x.slice(0,10)+"…":"—"}

async function load(){
  const rpc = document.getElementById('rpc').value.trim();
  const tx  = document.getElementById('tx').value.trim();
  document.getElementById('expl').innerHTML =
    tx ? `<a target="_blank" href="https://evm-testnet.0g.ai/tx/${tx}">evm-testnet.0g.ai</a>` : '—';

  try{
    const rec = await jrpc(rpc,"eth_getTransactionReceipt",[tx]);
    document.getElementById('raw').textContent = JSON.stringify(rec,null,2);

    // dene: docs/claims/<tx>.json içinden storage pointer oku
    try{
      const r = await fetch(`docs/claims/${tx}.json`);
      if(r.ok){
        const j = await r.json();
        const p = j?.storage?.pointer || j?.pointer || null;
        document.getElementById('pointer').textContent = p || "no pointer (not published)";
      }else{
        document.getElementById('pointer').textContent = "no pointer (not published)";
      }
    }catch(e){
      document.getElementById('pointer').textContent = "no pointer (not published)";
    }
  }catch(e){
    document.getElementById('raw').textContent = "⚠ " + e.message +
      "\n\nİpucu: RPC'yi https kullan; tx hash doğru olsun.";
  }
}
document.getElementById('load').onclick = load;
if(qs.get('tx')) load();
</script>
